name: Manual workflow
on:
  workflow_dispatch:

jobs:
  check-command:
    runs-on: ubuntu-20.04
    environment: test
    env:
      OPENSHIFT_SERVER: ${{ secrets.OPENSHIFT_SERVER }}
      OPENSHIFT_NAMESPACE: ${{ secrets.OPENSHIFT_NAMESPACE }}
    steps:
    - name: Check environment
      run: |
        whoami
        pwd
        ls -al
        which oc
        oc version
        env | sort
    - name: Determine app name
      if: env.APP_NAME == ''
      run: |
        echo "APP_NAME=$(basename $PWD)" | tee -a $GITHUB_ENV
    - name: Log in to OpenShift
      uses: redhat-actions/oc-login@v1
      with:
        openshift_server_url: ${{ env.OPENSHIFT_SERVER }}
        openshift_token: ${{ secrets.OPENSHIFT_TOKEN }}
        insecure_skip_tls_verify: true
        namespace: ${{ env.OPENSHIFT_NAMESPACE }}
    - name: Create project if not exists
      run: |
        if ! oc project ${{ env.OPENSHIFT_NAMESPACE }} ; then
          oc new-project ${{ env.OPENSHIFT_NAMESPACE }}
        fi
    - name: Run oc command
      run: |
        oc whoami
        oc status
        oc get all
